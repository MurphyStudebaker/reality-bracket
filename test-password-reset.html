<!DOCTYPE html>
<html>
<head>
    <title>Test Password Reset URL</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0f172a;
            color: #fff;
        }
        h1 { color: #BFFF0B; }
        .section {
            background: #1e293b;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .code {
            background: #334155;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            overflow-x: auto;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .warning {
            background: #fef3c7;
            color: #92400e;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #d1fae5;
            color: #065f46;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            background: #BFFF0B;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { opacity: 0.9; }
    </style>
</head>
<body>
    <h1>üîç Password Reset URL Checker</h1>
    
    <div class="section">
        <h2>Step 1: Check Your Current URL</h2>
        <div id="current-url"></div>
    </div>

    <div class="section">
        <h2>Step 2: Simulate Password Reset</h2>
        <p>Click this button to see what a password reset URL should look like:</p>
        <button onclick="simulateReset()">Simulate Password Reset URL</button>
        <div class="code" id="simulated-url"></div>
    </div>

    <div class="section">
        <h2>Step 3: Test Supabase Configuration</h2>
        <div class="warning">
            <strong>‚ö†Ô∏è Important Supabase Configuration</strong>
            <ol>
                <li>Go to your Supabase Dashboard</li>
                <li>Navigate to: <strong>Authentication ‚Üí URL Configuration</strong></li>
                <li>Add these Redirect URLs:
                    <div class="code">http://localhost:3000
http://localhost:3000/**
https://yourdomain.com
https://yourdomain.com/**</div>
                </li>
                <li>Save changes</li>
                <li>Request a NEW password reset email (old ones won't work)</li>
            </ol>
        </div>
    </div>

    <div class="section">
        <h2>Step 4: Check Email Template</h2>
        <div class="warning">
            <strong>Check your Supabase Email Template:</strong>
            <ol>
                <li>Go to: <strong>Authentication ‚Üí Email Templates</strong></li>
                <li>Find "Reset Password" or "Confirm Reset"</li>
                <li>Make sure the button/link uses: <code>{{ .ConfirmationURL }}</code></li>
                <li>NOT a hardcoded URL</li>
            </ol>
        </div>
    </div>

    <div class="section">
        <h2>What You Should See</h2>
        <div class="success">
            <strong>‚úÖ Correct URL format:</strong>
            <div class="code">http://localhost:3000#access_token=eyJh...&type=recovery&expires_in=3600&...</div>
        </div>
        <div class="error">
            <strong>‚ùå Wrong - just this means Supabase config issue:</strong>
            <div class="code">http://localhost:3000</div>
            or
            <div class="code">http://localhost:3000/#</div>
        </div>
    </div>

    <script>
        // Display current URL info
        function displayCurrentURL() {
            const info = {
                fullURL: window.location.href,
                pathname: window.location.pathname,
                hash: window.location.hash || '(none)',
                search: window.location.search || '(none)'
            };

            const hash = window.location.hash;
            const hashParams = hash ? new URLSearchParams(hash.substring(1)) : new URLSearchParams();
            
            let status = '';
            if (hashParams.get('type') === 'recovery') {
                status = '<div class="success"><strong>‚úÖ This IS a password reset URL!</strong><br>Type: ' + hashParams.get('type') + '</div>';
            } else if (hash && hash.length > 1) {
                status = '<div class="warning"><strong>‚ö†Ô∏è Has hash but not type=recovery</strong><br>Hash params: ' + JSON.stringify(Object.fromEntries(hashParams)) + '</div>';
            } else {
                status = '<div class="error"><strong>‚ùå No hash parameters - this is NOT a password reset URL</strong></div>';
            }

            document.getElementById('current-url').innerHTML = `
                <div class="code">${JSON.stringify(info, null, 2)}</div>
                ${status}
            `;
        }

        function simulateReset() {
            const simulatedURL = window.location.origin + '#access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9&type=recovery&expires_in=3600';
            document.getElementById('simulated-url').innerHTML = `
<strong>This is what a valid password reset URL looks like:</strong>

${simulatedURL}

<strong>Key parts:</strong>
- access_token=... (the JWT token)
- type=recovery (tells app this is password reset)
- expires_in=3600 (1 hour expiry)

<button onclick="window.location.href='${simulatedURL}'">Go to Simulated URL</button>
            `;
        }

        // Run on load
        displayCurrentURL();

        // Update when hash changes
        window.addEventListener('hashchange', displayCurrentURL);
    </script>
</body>
</html>

